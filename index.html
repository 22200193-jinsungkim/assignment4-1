<!DOCTYPE html>
<html>

<head>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <style>
        .buttondiv {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .centerBox {
            width: 350px;
            margin: 20px auto;
            padding: 15px;
            border: 1px solid black;
            border-radius: 6px;
            display: none;
            text-align: center;
        }
    </style>

    </style>
</head>

<body>



    <div class="buttondiv">
        <button type="button" onclick="getGame()">데이터 목록보기</button>
        <button type="button" onclick="showAdd()">데이터 추가</button>
        <button type="button" onclick="showEdit()">데이터 수정</button>
        <input type="text" id="input_id" style="width:100px;" placeholder="Delete ID">
        <button type="button" onclick="deleteGame()">데이터삭제</button>

    </div>

    <div style="margin-top: 30px;text-align: center;" id="div_list">목록</div>

    <div id="addBox" class="centerBox">
        <h3>데이터 추가</h3>
        ID: <input type="text" id="inputadd_id"><br><br>
        NAME: <input type="text" id="inputadd_name"><br><br>
        유통사: <input type="text" id="inputadd_publisher"><br><br>
        점유율: <input type="text" id="inputadd_share"><br><br>

        <button onclick="addGame()">추가하기</button>
        <button onclick="hideBoxes()">닫기</button>
    </div>


    <div id="editBox" class="centerBox">
        <h3>데이터 수정</h3>
        ID: <input type="text" id="inputedit_id"><br><br>
        NAME: <input type="text" id="inputedit_name"><br><br>
        유통사: <input type="text" id="inputedit_publisher"><br><br>
        점유율: <input type="text" id="inputedit_share"><br><br>

        <button onclick="updateGame()">수정하기</button>
        <button onclick="hideBoxes()">닫기</button>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        function showAdd() {
            hideBoxes();
            $("#addBox").show();
        }

        function showEdit() {
            hideBoxes();
            $("#editBox").show();
        }

        function hideBoxes() {
            $("#addBox").hide();
            $("#editBox").hide();
        }

        function getGame() {
            $("#addBox").hide();
            $("#editBox").hide();
            const xhr = new XMLHttpRequest();
            xhr.open("GET", "http://localhost:3000/GAME");
            xhr.setRequestHeader("content-type", "application/json");
            xhr.send();
            xhr.onload = () => {
                if (xhr.status === 200) {
                    const res = JSON.parse(xhr.response);

                    $("#div_list").html("");
                    for (let each of res) {
                        $("#div_list").append(
                            "<div>" + each["id"] + "//" + each["name"] + "//" + each["publisher"] + "//" + each["share"] + "</div>"
                        );
                    }
                } else {
                    console.log(xhr.status, xhr.statusText);
                }
            }
        }

        function updateGame() {
            const xhr = new XMLHttpRequest();
            let id = Number($("#inputedit_id").val());
            xhr.open("PUT", "http://localhost:3000/GAME/" + id);
            xhr.setRequestHeader("content-type", "application/json");
            let data = { id: $("#inputedit_id").val(), name: $("#inputedit_name").val(), share: $("#inputedit_share").val(), publisher: $("#inputedit_publisher").val(), };
            xhr.send(JSON.stringify(data));
            xhr.onload = () => {
                if (xhr.status === 200) {
                    const res = JSON.parse(xhr.response);
                    alert(JSON.stringify(res));
                    getGame();
                } else {
                    console.log(xhr.status, xhr.statusText);
                }
            }
        }

        function addGame() {
            const xhr = new XMLHttpRequest();
            xhr.open("POST", "http://localhost:3000/GAME");
            xhr.setRequestHeader("content-type", "application/json");
            let data = { id: $("#inputadd_id").val(), name: $("#inputadd_name").val(), share: $("#inputadd_share").val(), publisher: $("#inputadd_publisher").val(), };
            xhr.send(JSON.stringify(data));
            xhr.onload = () => {
                if (xhr.status === 200) {
                    const res = JSON.parse(xhr.response);
                    alert(JSON.stringify(res));
                    getGame();
                } else {
                    console.log(xhr.status, xhr.statusText);
                }
            }
        }
        function deleteGame() {
            const xhr = new XMLHttpRequest();
            let id = Number($("#input_id").val());
            xhr.open("DELETE", "http://localhost:3000/GAME/" + id);
            xhr.setRequestHeader("content-type", "application/json");
            xhr.send();
            xhr.onload = () => {
                if (xhr.status === 200) {
                    alert("삭제 완료");
                    getGame();
                } else {
                    alert("삭제 실패");
                    console.log(xhr.status, xhr.statusText);
                }
            };
        }
    </script>
</body>

</html>